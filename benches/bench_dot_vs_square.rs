
use ndarray_linalg::conjugate;
use ndarray_linalg::operator::LinearOperator;
use criterion::{black_box, criterion_group, criterion_main, Criterion};
use exact_diagonalization::prelude::*;


fn use_dot(right : &Array2<Complex64>, ediag : &Array2<Complex64>) -> Array1<Complex64>{
    // 2x2 matrix의 경우
    // Collecting 100 samples in estimated 5.0026 s (7.1M iterations)
    // time:   [710.76 ns 713.44 ns 716.31 ns]
    //
    // 10x10 matrix의 경우
    // Collecting 100 samples in estimated 5.0066 s (3.2M iterations)
    // time:   [1.5649 us 1.5688 us 1.5730 us]

    let left : Array2<Complex64> = conjugate(right);
    (left.dot(ediag).dot(right) - ediag).into_diag()
}

fn use_square(right : &Array2<Complex64>, eval : &Array1<Complex64>) -> Array1<Complex64>{
    // 2x2 matrix의 경우
    // Collecting 100 samples in estimated 5.0003 s (24M iterations)
    // time:   [208.46 ns 210.05 ns 211.67 ns]
    //
    // 10x10 matrix의 경우
    // Collecting 100 samples in estimated 5.0009 s (14M iterations)
    // time:   [354.23 ns 355.55 ns 356.92 ns]
    //
    // 2x2에선 3.3배  10x10에서는 4.4배인것으로 보아 시스템이 커질수록 점차 더 빠를 것.
    let right_abs = right.map(|x| x * x.conj());
    right_abs.apply(eval) - eval
}


fn bench_dot(c: &mut Criterion) {
    let right : Array2<Complex64> = arr2(&[
        [Complex64 { re: 0.020398531270699308, im: -0.9997410721400063 }, Complex64 { re: 0.009810455205422956, im: 0.002333145304407931 }],
        [Complex64 { re: 0.009810455205422956, im: 0.002333145304407931 }, Complex64 { re: 0.43185141583749437, im: -0.9018883889045265 }]
    ]);
    let eval : Array1<Complex64> = arr1(&[-1.55063021095925, 5.159192658223166]).map(|x| Complex64::from(x));
    let ediag : Array2<Complex64> = Array2::from_diag(&&eval);

    c.bench_function("use dot product", |b| {
        b.iter(|| {
            use_dot(black_box(&right), black_box(&ediag))
        })
    });
}

fn bench_dot_large(c : &mut Criterion){
    let right : Array2<Complex64> = arr2(&[[Complex64 { re: -0.3643642048096553, im: 0.9192999959191098 }, Complex64 { re: -0.055655596379817325, im: -0.13537484482885642 }, Complex64 { re: -0.01880894034367476, im: 0.017423575226473528 }, Complex64 { re: 0.00000000000000002806707267887897, im: 0.0000000000000001504056671016767 }, Complex64 { re: 0.000000000000000016291577442976815, im: -0.0000000000000000016808186951136224 }, Complex64 { re: 0.003487317208470262, im: 0.0021318687126996422 }, Complex64 { re: -0.0022147774793373765, im: -0.004147619214963955 }, Complex64 { re: -0.000000000000000013530742920819081, im: 0.000000000000000007897126168735666 }, Complex64 { re: -0.0007919411696663073, im: 0.002352954160033662 }, Complex64 { re: 0.00010221441638794121, im: -0.00006544739581514722 }],
 [Complex64 { re: -0.05565559637981733, im: -0.13537484482885642 }, Complex64 { re: -0.9074122383518008, im: -0.3811731481125812 }, Complex64 { re: -0.07990569678608306, im: 0.014558861585519807 }, Complex64 { re: 0.00000000000000008161658412199244, im: 0.000000000000000022731782473825858 }, Complex64 { re: -0.0000000000000000916770272816061, im: 0.0000000000000000620249320416437 }, Complex64 { re: 0.010017291128962887, im: 0.0168897437124751 }, Complex64 { re: -0.024347433740527308, im: -0.04704544349830072 }, Complex64 { re: 0.00000000000000009407153278599027, im: 0.00000000000000003378971061230266 }, Complex64 { re: 0.009818171757821, im: -0.0006031336836881924 }, Complex64 { re: -0.0007564788585471584, im: -0.000522132021068651 }],
 [Complex64 { re: -0.01880894034367476, im: 0.017423575226473528 }, Complex64 { re: -0.07990569678608306, im: 0.014558861585519806 }, Complex64 { re: 0.7182784748933213, im: -0.6881491736644677 }, Complex64 { re: 0.00000000000000031306248386568985, im: 0.0000000000000002157299381824065 }, Complex64 { re: 0.0000000000000000009001354791723587, im: 0.00000000000000013086448695474235 }, Complex64 { re: -0.0032490464663137318, im: 0.008693996291679117 }, Complex64 { re: 0.02760791927579975, im: -0.04918585360776593 }, Complex64 { re: -0.000000000000000006179474933352265, im: 0.00000000000000007213893614066475 }, Complex64 { re: 0.001145572526352482, im: 0.0016577319789955352 }, Complex64 { re: -0.0008879522318565833, im: -0.00027037484601068 }],
 [Complex64 { re: 0.00000000000000002806707267887897, im: 0.00000000000000015040566710167672 }, Complex64 { re: 0.00000000000000008161658412199244, im: 0.000000000000000022731782473825864 }, Complex64 { re: 0.00000000000000031306248386568985, im: 0.0000000000000002157299381824065 }, Complex64 { re: 1.0000000000000002, im: -0.000000000000000525909125763792 }, Complex64 { re: 0.00000000000000012003993790133393, im: 0.0000000000000001340793846424412 }, Complex64 { re: 0.0000000000000000782552057306135, im: -0.00000000000000008769826442164842 }, Complex64 { re: -0.000000000000000033514071277820815, im: 0.00000000000000011376568874547858 }, Complex64 { re: 0.0000000000000005526403257719237, im: 0.00000000000000014714181683096406 }, Complex64 { re: 0.0000000000000001128573885786755, im: -0.00000000000000005154567865431949 }, Complex64 { re: 0.00000000000000021792920837111086, im: 0.000000000000000018158843015545153 }],
 [Complex64 { re: 0.000000000000000016291577442976818, im: -0.000000000000000001680818695113622 }, Complex64 { re: -0.00000000000000009167702728160608, im: 0.0000000000000000620249320416437 }, Complex64 { re: 0.000000000000000000900135479172359, im: 0.00000000000000013086448695474235 }, Complex64 { re: 0.00000000000000012003993790133393, im: 0.0000000000000001340793846424412 }, Complex64 { re: 1.000000000000001, im: 0.0000000000000005259091257637897 }, Complex64 { re: 0.0000000000000002681381266749787, im: 0.000000000000000007143928686706955 }, Complex64 { re: 0.00000000000000014541326691194153, im: -0.0000000000000001091571125153923 }, Complex64 { re: -0.00000000000000002518778148797744, im: 0.00000000000000001542236326612924 }, Complex64 { re: -0.000000000000000010019195397623886, im: 0.000000000000000013755468138222326 }, Complex64 { re: -0.00000000000000007630410583397516, im: 0.0000000000000000011443183167314389 }],
 [Complex64 { re: 0.003487317208470263, im: 0.0021318687126996427 }, Complex64 { re: 0.010017291128962887, im: 0.0168897437124751 }, Complex64 { re: -0.003249046466313731, im: 0.008693996291679117 }, Complex64 { re: 0.0000000000000000782552057306135, im: -0.00000000000000008769826442164843 }, Complex64 { re: 0.0000000000000002681381266749787, im: 0.000000000000000007143928686706957 }, Complex64 { re: -0.08785917027336115, im: 0.9944821118756193 }, Complex64 { re: -0.0013009126258850437, im: 0.0007976124418581516 }, Complex64 { re: 0.00000000000000017807876254962041, im: 0.0000000000000002373684115910057 }, Complex64 { re: -0.02608648167599472, im: 0.0458636963023847 }, Complex64 { re: 0.003364896585516033, im: 0.00005848950272785251 }],
 [Complex64 { re: -0.002214777479337377, im: -0.004147619214963955 }, Complex64 { re: -0.024347433740527308, im: -0.04704544349830072 }, Complex64 { re: 0.027607919275799746, im: -0.04918585360776593 }, Complex64 { re: -0.000000000000000033514071277820815, im: 0.00000000000000011376568874547858 }, Complex64 { re: 0.00000000000000014541326691194153, im: -0.0000000000000001091571125153923 }, Complex64 { re: -0.0013009126258850439, im: 0.0007976124418581527 }, Complex64 { re: -0.28904359295450976, im: 0.9539816560514379 }, Complex64 { re: 0.0000000000000003215255492821676, im: 0.0000000000000003725951526874636 }, Complex64 { re: 0.006500335737864863, im: -0.007267116151698841 }, Complex64 { re: 0.008915739463629157, im: 0.013648894020604017 }],
 [Complex64 { re: -0.000000000000000013530742920819083, im: 0.000000000000000007897126168735666 }, Complex64 { re: 0.00000000000000009407153278599027, im: 0.00000000000000003378971061230266 }, Complex64 { re: -0.000000000000000006179474933352264, im: 0.00000000000000007213893614066475 }, Complex64 { re: 0.0000000000000005526403257719237, im: 0.00000000000000014714181683096406 }, Complex64 { re: -0.00000000000000002518778148797744, im: 0.000000000000000015422363266129243 }, Complex64 { re: 0.00000000000000017807876254962041, im: 0.0000000000000002373684115910057 }, Complex64 { re: 0.0000000000000003215255492821676, im: 0.0000000000000003725951526874636 }, Complex64 { re: -0.8929365317281035, im: -0.4501825744132992 }, Complex64 { re: -0.00000000000000012620390368442958, im: 0.000000000000000006555392547838731 }, Complex64 { re: -0.0000000000000001119425251212671, im: -0.00000000000000004682316693824667 }],
 [Complex64 { re: -0.0007919411696663074, im: 0.0023529541600336617 }, Complex64 { re: 0.009818171757820997, im: -0.0006031336836881928 }, Complex64 { re: 0.0011455725263524816, im: 0.0016577319789955354 }, Complex64 { re: 0.0000000000000001128573885786755, im: -0.00000000000000005154567865431948 }, Complex64 { re: -0.000000000000000010019195397623884, im: 0.000000000000000013755468138222326 }, Complex64 { re: -0.02608648167599472, im: 0.045863696302384696 }, Complex64 { re: 0.006500335737864863, im: -0.007267116151698841 }, Complex64 { re: -0.00000000000000012620390368442958, im: 0.000000000000000006555392547838726 }, Complex64 { re: 0.8065014023288753, im: -0.5809452552951876 }, Complex64 { re: -0.09149926114619208, im: 0.026456584282951834 }],
 [Complex64 { re: 0.00010221441638794122, im: -0.00006544739581514722 }, Complex64 { re: -0.0007564788585471583, im: -0.000522132021068651 }, Complex64 { re: -0.0008879522318565834, im: -0.00027037484601068 }, Complex64 { re: 0.00000000000000021792920837111086, im: 0.000000000000000018158843015545156 }, Complex64 { re: -0.00000000000000007630410583397517, im: 0.000000000000000001144318316731439 }, Complex64 { re: 0.003364896585516033, im: 0.00005848950272785247 }, Complex64 { re: 0.008915739463629158, im: 0.013648894020604015 }, Complex64 { re: -0.0000000000000001119425251212671, im: -0.00000000000000004682316693824667 }, Complex64 { re: -0.09149926114619208, im: 0.026456584282951837 }, Complex64 { re: -0.993468974714639, im: -0.060568149996683925 }]]);

    let ediag : Array2<Complex64> = arr2(&[[Complex64 { re: -4.625411045225333, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }],
 [Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: -2.6929925434279993, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }],
 [Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: -0.7353612496532898, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }],
 [Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: -0.000000000000000259680814274547, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }],
 [Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0000000000000007037700241246077, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }],
 [Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 1.6842393849623578, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }],
 [Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 2.1422126607238523, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }],
 [Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 4.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }],
 [Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 6.14845538472615, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }],
 [Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 0.0, im: 0.0 }, Complex64 { re: 10.078857407894265, im: 0.0 }]]);

    c.bench_function("use dot product", |b| {
        b.iter(|| {
            use_dot(black_box(&right), black_box(&ediag))
        })
    });
}



fn bench_square(c: &mut Criterion) {
    let right : Array2<Complex64> = arr2(&[
        [Complex64 { re: 0.020398531270699308, im: -0.9997410721400063 }, Complex64 { re: 0.009810455205422956, im: 0.002333145304407931 }],
        [Complex64 { re: 0.009810455205422956, im: 0.002333145304407931 }, Complex64 { re: 0.43185141583749437, im: -0.9018883889045265 }]
    ]);
    let eval : Array1<Complex64> = arr1(&[-1.55063021095925, 5.159192658223166]).map(|x| Complex64::from(x));

    c.bench_function("use square", |b| {
        b.iter(|| use_square(black_box(&right), black_box(&eval)))
    });
}

fn bench_square_large(c : &mut Criterion){
    let right : Array2<Complex64> = arr2(&[[Complex64 { re: -0.3643642048096553, im: 0.9192999959191098 }, Complex64 { re: -0.055655596379817325, im: -0.13537484482885642 }, Complex64 { re: -0.01880894034367476, im: 0.017423575226473528 }, Complex64 { re: 0.00000000000000002806707267887897, im: 0.0000000000000001504056671016767 }, Complex64 { re: 0.000000000000000016291577442976815, im: -0.0000000000000000016808186951136224 }, Complex64 { re: 0.003487317208470262, im: 0.0021318687126996422 }, Complex64 { re: -0.0022147774793373765, im: -0.004147619214963955 }, Complex64 { re: -0.000000000000000013530742920819081, im: 0.000000000000000007897126168735666 }, Complex64 { re: -0.0007919411696663073, im: 0.002352954160033662 }, Complex64 { re: 0.00010221441638794121, im: -0.00006544739581514722 }],
 [Complex64 { re: -0.05565559637981733, im: -0.13537484482885642 }, Complex64 { re: -0.9074122383518008, im: -0.3811731481125812 }, Complex64 { re: -0.07990569678608306, im: 0.014558861585519807 }, Complex64 { re: 0.00000000000000008161658412199244, im: 0.000000000000000022731782473825858 }, Complex64 { re: -0.0000000000000000916770272816061, im: 0.0000000000000000620249320416437 }, Complex64 { re: 0.010017291128962887, im: 0.0168897437124751 }, Complex64 { re: -0.024347433740527308, im: -0.04704544349830072 }, Complex64 { re: 0.00000000000000009407153278599027, im: 0.00000000000000003378971061230266 }, Complex64 { re: 0.009818171757821, im: -0.0006031336836881924 }, Complex64 { re: -0.0007564788585471584, im: -0.000522132021068651 }],
 [Complex64 { re: -0.01880894034367476, im: 0.017423575226473528 }, Complex64 { re: -0.07990569678608306, im: 0.014558861585519806 }, Complex64 { re: 0.7182784748933213, im: -0.6881491736644677 }, Complex64 { re: 0.00000000000000031306248386568985, im: 0.0000000000000002157299381824065 }, Complex64 { re: 0.0000000000000000009001354791723587, im: 0.00000000000000013086448695474235 }, Complex64 { re: -0.0032490464663137318, im: 0.008693996291679117 }, Complex64 { re: 0.02760791927579975, im: -0.04918585360776593 }, Complex64 { re: -0.000000000000000006179474933352265, im: 0.00000000000000007213893614066475 }, Complex64 { re: 0.001145572526352482, im: 0.0016577319789955352 }, Complex64 { re: -0.0008879522318565833, im: -0.00027037484601068 }],
 [Complex64 { re: 0.00000000000000002806707267887897, im: 0.00000000000000015040566710167672 }, Complex64 { re: 0.00000000000000008161658412199244, im: 0.000000000000000022731782473825864 }, Complex64 { re: 0.00000000000000031306248386568985, im: 0.0000000000000002157299381824065 }, Complex64 { re: 1.0000000000000002, im: -0.000000000000000525909125763792 }, Complex64 { re: 0.00000000000000012003993790133393, im: 0.0000000000000001340793846424412 }, Complex64 { re: 0.0000000000000000782552057306135, im: -0.00000000000000008769826442164842 }, Complex64 { re: -0.000000000000000033514071277820815, im: 0.00000000000000011376568874547858 }, Complex64 { re: 0.0000000000000005526403257719237, im: 0.00000000000000014714181683096406 }, Complex64 { re: 0.0000000000000001128573885786755, im: -0.00000000000000005154567865431949 }, Complex64 { re: 0.00000000000000021792920837111086, im: 0.000000000000000018158843015545153 }],
 [Complex64 { re: 0.000000000000000016291577442976818, im: -0.000000000000000001680818695113622 }, Complex64 { re: -0.00000000000000009167702728160608, im: 0.0000000000000000620249320416437 }, Complex64 { re: 0.000000000000000000900135479172359, im: 0.00000000000000013086448695474235 }, Complex64 { re: 0.00000000000000012003993790133393, im: 0.0000000000000001340793846424412 }, Complex64 { re: 1.000000000000001, im: 0.0000000000000005259091257637897 }, Complex64 { re: 0.0000000000000002681381266749787, im: 0.000000000000000007143928686706955 }, Complex64 { re: 0.00000000000000014541326691194153, im: -0.0000000000000001091571125153923 }, Complex64 { re: -0.00000000000000002518778148797744, im: 0.00000000000000001542236326612924 }, Complex64 { re: -0.000000000000000010019195397623886, im: 0.000000000000000013755468138222326 }, Complex64 { re: -0.00000000000000007630410583397516, im: 0.0000000000000000011443183167314389 }],
 [Complex64 { re: 0.003487317208470263, im: 0.0021318687126996427 }, Complex64 { re: 0.010017291128962887, im: 0.0168897437124751 }, Complex64 { re: -0.003249046466313731, im: 0.008693996291679117 }, Complex64 { re: 0.0000000000000000782552057306135, im: -0.00000000000000008769826442164843 }, Complex64 { re: 0.0000000000000002681381266749787, im: 0.000000000000000007143928686706957 }, Complex64 { re: -0.08785917027336115, im: 0.9944821118756193 }, Complex64 { re: -0.0013009126258850437, im: 0.0007976124418581516 }, Complex64 { re: 0.00000000000000017807876254962041, im: 0.0000000000000002373684115910057 }, Complex64 { re: -0.02608648167599472, im: 0.0458636963023847 }, Complex64 { re: 0.003364896585516033, im: 0.00005848950272785251 }],
 [Complex64 { re: -0.002214777479337377, im: -0.004147619214963955 }, Complex64 { re: -0.024347433740527308, im: -0.04704544349830072 }, Complex64 { re: 0.027607919275799746, im: -0.04918585360776593 }, Complex64 { re: -0.000000000000000033514071277820815, im: 0.00000000000000011376568874547858 }, Complex64 { re: 0.00000000000000014541326691194153, im: -0.0000000000000001091571125153923 }, Complex64 { re: -0.0013009126258850439, im: 0.0007976124418581527 }, Complex64 { re: -0.28904359295450976, im: 0.9539816560514379 }, Complex64 { re: 0.0000000000000003215255492821676, im: 0.0000000000000003725951526874636 }, Complex64 { re: 0.006500335737864863, im: -0.007267116151698841 }, Complex64 { re: 0.008915739463629157, im: 0.013648894020604017 }],
 [Complex64 { re: -0.000000000000000013530742920819083, im: 0.000000000000000007897126168735666 }, Complex64 { re: 0.00000000000000009407153278599027, im: 0.00000000000000003378971061230266 }, Complex64 { re: -0.000000000000000006179474933352264, im: 0.00000000000000007213893614066475 }, Complex64 { re: 0.0000000000000005526403257719237, im: 0.00000000000000014714181683096406 }, Complex64 { re: -0.00000000000000002518778148797744, im: 0.000000000000000015422363266129243 }, Complex64 { re: 0.00000000000000017807876254962041, im: 0.0000000000000002373684115910057 }, Complex64 { re: 0.0000000000000003215255492821676, im: 0.0000000000000003725951526874636 }, Complex64 { re: -0.8929365317281035, im: -0.4501825744132992 }, Complex64 { re: -0.00000000000000012620390368442958, im: 0.000000000000000006555392547838731 }, Complex64 { re: -0.0000000000000001119425251212671, im: -0.00000000000000004682316693824667 }],
 [Complex64 { re: -0.0007919411696663074, im: 0.0023529541600336617 }, Complex64 { re: 0.009818171757820997, im: -0.0006031336836881928 }, Complex64 { re: 0.0011455725263524816, im: 0.0016577319789955354 }, Complex64 { re: 0.0000000000000001128573885786755, im: -0.00000000000000005154567865431948 }, Complex64 { re: -0.000000000000000010019195397623884, im: 0.000000000000000013755468138222326 }, Complex64 { re: -0.02608648167599472, im: 0.045863696302384696 }, Complex64 { re: 0.006500335737864863, im: -0.007267116151698841 }, Complex64 { re: -0.00000000000000012620390368442958, im: 0.000000000000000006555392547838726 }, Complex64 { re: 0.8065014023288753, im: -0.5809452552951876 }, Complex64 { re: -0.09149926114619208, im: 0.026456584282951834 }],
 [Complex64 { re: 0.00010221441638794122, im: -0.00006544739581514722 }, Complex64 { re: -0.0007564788585471583, im: -0.000522132021068651 }, Complex64 { re: -0.0008879522318565834, im: -0.00027037484601068 }, Complex64 { re: 0.00000000000000021792920837111086, im: 0.000000000000000018158843015545156 }, Complex64 { re: -0.00000000000000007630410583397517, im: 0.000000000000000001144318316731439 }, Complex64 { re: 0.003364896585516033, im: 0.00005848950272785247 }, Complex64 { re: 0.008915739463629158, im: 0.013648894020604015 }, Complex64 { re: -0.0000000000000001119425251212671, im: -0.00000000000000004682316693824667 }, Complex64 { re: -0.09149926114619208, im: 0.026456584282951837 }, Complex64 { re: -0.993468974714639, im: -0.060568149996683925 }]]);

    let eval : Array1<Complex64> = arr1(&[Complex64 { re: -4.625411045225333, im: 0.0 }, Complex64 { re: -2.6929925434279993, im: 0.0 }, Complex64 { re: -0.7353612496532898, im: 0.0 }, Complex64 { re: -0.000000000000000259680814274547, im: 0.0 }, Complex64 { re: 0.0000000000000007037700241246077, im: 0.0 }, Complex64 { re: 1.6842393849623578, im: 0.0 }, Complex64 { re: 2.1422126607238523, im: 0.0 }, Complex64 { re: 4.0, im: 0.0 }, Complex64 { re: 6.14845538472615, im: 0.0 }, Complex64 { re: 10.078857407894265, im: 0.0 }]);

    c.bench_function("use square", |b| {
        b.iter(|| use_square(black_box(&right), black_box(&eval)))
    });
}

criterion_group!(benches, bench_dot_large, bench_square_large);
criterion_main!(benches);
